<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Current NRR Calculation</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
        crossorigin="anonymous">
    <style>
        body {
            font-size: 15px !important;
            font-family: 'Lucida Sans', Geneva, Verdana, sans-serif;
        }

        h4 {
            color: rgb(0, 123, 255);
        }

        .result {
            margin-top: 20px;
        }

        .error {
            color: red;
        }
    </style>
</head>

<body>
    <div class="container">
        <br>
        <h4 class="text-center">NRR Calculation</h4>
        <form id="nrrForm">
            <div class="form-group">
                <label for="supporting_team">Supporting Team</label>
                <input type="text" class="form-control" id="supporting_team" required>
            </div>
            <div class="form-group">
                <label for="against_team">Opposing Team</label>
                <input type="text" class="form-control" id="against_team" required>
            </div>
            <div class="form-group">
                <label for="runs_scored">Total Runs Scored by Your Team</label>
                <input type="number" step="any" class="form-control" id="runs_scored" required>
            </div>
            <div class="form-group">
                <label for="overs_played">Total Overs Played by Your Team (e.g., 19.4)</label>
                <input type="text" class="form-control" id="overs_played" required>
            </div>
            <div class="form-group">
                <label for="runs_scored_against">Total Runs Conceded</label>
                <input type="number" step="any" class="form-control" id="runs_scored_against" required>
            </div>
            <div class="form-group">
                <label for="overs_played_against">Total Overs Bowled by Your Team (e.g., 20.0)</label>
                <input type="text" class="form-control" id="overs_played_against" required>
            </div>
            <div class="form-group">
                <label for="overs">Overs in the Final Match</label>
                <input type="text" class="form-control" id="overs" required>
            </div>
            <div class="form-group">
                <label for="final_runs">Runs Expected in Final Match</label>
                <input type="number" step="any" class="form-control" id="final_runs" required>
            </div>
            <div class="form-group">
                <label for="required_NRR">Required NRR to Qualify</label>
                <input type="number" step="any" class="form-control" id="required_NRR" required>
            </div>
            <button type="button" class="btn btn-primary" onclick="calculateNRR()">Calculate</button>
        </form>

        <div class="result">
            <h4 id="result_heading" style="visibility: hidden;">Result</h4>
            <p id="current_nrr"></p>
            <p id="opponent_batting_first"></p>
            <p id="your_team_batting_first"></p>
            <p id="error" class="error"></p>
        </div>
    </div>

    <script>
        // Convert X.Y format to total balls
        function oversToBalls(overs) {
            const [whole, decimal] = overs.split('.').map(Number);
            if (decimal >= 6) return NaN;
            return (whole * 6) + (decimal || 0);
        }

        // Convert balls back to overs in X.Y format
        function ballsToOvers(balls) {
            const fullOvers = Math.floor(balls / 6);
            const ballsLeft = balls % 6;
            return `${fullOvers}.${ballsLeft}`;
        }

        function calculateNRR() {
            document.getElementById("result_heading").style.visibility = "visible";
            document.getElementById("error").innerHTML = "";

            try {
                const team = document.getElementById("supporting_team").value.trim();
                const opponent = document.getElementById("against_team").value.trim();
                const runsScored = parseFloat(document.getElementById("runs_scored").value);
                const oversPlayed = oversToBalls(document.getElementById("overs_played").value);
                const runsAgainst = parseFloat(document.getElementById("runs_scored_against").value);
                const oversAgainst = oversToBalls(document.getElementById("overs_played_against").value);
                const matchOvers = oversToBalls(document.getElementById("overs").value);
                const finalRuns = parseInt(document.getElementById("final_runs").value);
                const requiredNRR = parseFloat(document.getElementById("required_NRR").value);

                // Validate overs
                if (isNaN(oversPlayed) || isNaN(oversAgainst) || isNaN(matchOvers)) {
                    throw new Error("Invalid overs format. Use X.Y format (e.g., 19.4 means 19 overs and 4 balls).");
                }

                // Calculate current NRR
                const currentNRR = ((runsScored / (oversPlayed / 6)) - (runsAgainst / (oversAgainst / 6))).toFixed(3);
                document.getElementById("current_nrr").innerHTML = `Current NRR of ${team}: <strong>${currentNRR}</strong>`;

                // --- Opponent Batting First ---
                const totalScored = runsScored + finalRuns + 1;
                const totalAgainst = runsAgainst + finalRuns;
                const totalOversAgainst = oversAgainst + matchOvers;
                const denominator = (totalAgainst / (totalOversAgainst / 6)) + requiredNRR;
                const finalOversRequired = ((totalScored / denominator) - (oversPlayed / 6)) * 6;
                const chaseOvers = ballsToOvers(Math.ceil(finalOversRequired));

                document.getElementById("opponent_batting_first").innerHTML =
                    `If <strong>${opponent}</strong> bats first, <strong>${team}</strong> must chase ${finalRuns} in <strong>${chaseOvers} overs</strong> to reach NRR ${requiredNRR}.`;

                // --- Your Team Batting First ---
                const newRuns = runsScored + finalRuns;
                const newOvers = oversPlayed + matchOvers;
                const newOversAgainst = oversAgainst + matchOvers;
                const maxRunsConceded = Math.floor(((newRuns / (newOvers / 6)) - requiredNRR) * (newOversAgainst / 6)) - runsAgainst;

                document.getElementById("your_team_batting_first").innerHTML =
                    `If <strong>${team}</strong> bats first, they must restrict <strong>${opponent}</strong> to <strong>${maxRunsConceded} runs</strong> or less.`;

            } catch (error) {
                document.getElementById("error").innerText = error.message;
                document.getElementById("result_heading").style.visibility = "hidden";
            }
        }
    </script>
</body>

</html>
